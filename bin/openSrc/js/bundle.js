var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}();!function(){function e(t,a,n){function r(o,s){if(!a[o]){if(!t[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(i)return i(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var d=a[o]={exports:{}};t[o][0].call(d.exports,function(e){return r(t[o][1][e]||e)},d,d.exports,e,t,a,n)}return a[o].exports}for(var i="function"==typeof require&&require,o=0;o<n.length;o++)r(n[o]);return r}return e}()({1:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=function(){function e(){}return e.init=function(){Laya.ClassUtils.regClass},e.width=640,e.height=1136,e.scaleMode="fixedwidth",e.screenMode="none",e.alignV="top",e.alignH="left",e.startScene="FriendRank.scene",e.sceneRoot="",e.debug=!1,e.stat=!1,e.physicsDebug=!1,e.exportSceneToJson=!0,e}();a.default=n,n.init()},{}],2:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=e("./GameConfig"),r=e("./script/FriendRankView"),i=e("./script/CommonData");new(function(){function e(){Laya.isWXOpenDataContext=!0,Laya.init(n.default.width,n.default.height,Laya.canvas),Laya.stage.scaleMode=n.default.scaleMode,Laya.stage.screenMode=n.default.screenMode,Laya.URL.exportSceneToJson=n.default.exportSceneToJson,Laya.alertGlobalError=!0,this.onConfigLoaded()}return e.prototype.onConfigLoaded=function(){Laya.Browser.onMiniGame&&(window.wx.getUserInfo({openIdList:["selfOpenId"],lang:"zh_CN",success:function(e){var t=e.data;"selfOpenId"==t[0].openId&&(i.default.avatarUrl=t[0].avatarUrl,i.default.nickName=t[0].nickName)}}),i.default.GetFriends(null,null),Laya.Browser.window.wx.onMessage(function(e){switch("res/atlas/rank.atlas"==e.url&&Laya.loader.load("res/atlas/rank.atlas",Laya.Handler.create(this,function(){console.log("res/atlas/rank.atlas加载完成")})),e.type){case"openFriendList":this.closeOtherView(),this.friendRank=new r.FriendRankView,Laya.stage.addChild(this.friendRank);var t=this;i.default.GetFriends(this,function(){t.friendRank.drawRankList(i.default.friends)});break;case"closeRankUI":this.friendRank&&(this.friendRank.close(),this.friendRank=null);break;case"upScore":i.default.UpdateSelfScore(e.data)}}.bind(this)))},e.prototype.closeOtherView=function(){this.friendRank&&(this.friendRank.close(),this.friendRank=null)},e}())},{"./GameConfig":1,"./script/CommonData":3,"./script/FriendRankView":4}],3:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=function(){function e(){}return e.GetFriends=function(t,a){var n=this;this.NeedRefresh(e.preFriendsTime)?window.wx.getFriendCloudStorage({keyList:["level","viewId"],success:function(r){e.preFriendsTime=Laya.Browser.now(),e.friends=[],r.data.forEach(function(t){if(t.KVDataList.length>0){for(var a=0,n=0;n<t.KVDataList.length;n++)"level"==t.KVDataList[n].key&&(a=parseInt(t.KVDataList[n].value));if(e.friends.push({nickname:t.nickname,avatarUrl:t.avatarUrl,score:a,viewId:3001}),!e.avatarCache[t.avatarUrl]&&a>1){var r=new Laya.Texture;r.load(t.avatarUrl.replace("/132","/46")),e.avatarCache[t.avatarUrl]=r}}}),n.SortScore(e.friends),a&&a.call(t,e.friends)}}):a&&a.call(t,e.friends)},e.NeedRefresh=function(t){return Laya.Browser.now()-t>e.refreshTime},e.UpdateSelfScore=function(t){for(var a=0;a<e.friends.length;a++)if(e.friends[a].avatarUrl==e.avatarUrl){console.log("刷新玩家数据:"+t),e.friends[a].score=t;break}this.SortScore(e.friends)},e.SortScore=function(e){e=e.sort(function(e,t){return e.score>t.score?-1:(e.score,t.score,1)})},e.refreshTime=36e5,e.avatarUrl="",e.nickName="",e.avatarUrlGroup="",e.nickNameGroup="",e.preFriendsTime=0,e.friends=[],e.avatarCache={},e}();a.default=n},{}],4:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=e("../ui/layaMaxUI"),r=e("./CommonData"),i=function(e){function t(){var t=e.call(this)||this;return t.init(),t}return __extends(t,e),t.prototype.init=function(){this.rankList.array=[],this.rankList.renderHandler=new Laya.Handler(this,this.onRender),this.rankList.vScrollBarSkin="",this.noRank.visible=!1,this.selfRank.visible=!1},t.prototype.drawRankList=function(e){this.rankList.scrollTo(0);var t=!1;this.selfHead.skin=""==r.default.avatarUrl||null==r.default.avatarUrl?"rank/toux@2x.png":r.default.avatarUrl,this.selfName.text=r.default.nickName,e.forEach(function(e){e.avatarUrl==r.default.avatarUrl&&(t=!0)}),this.rankList.repeatY=e.length,this.rankList.array=e,this.rankList.refresh();var a=-1;if(t)for(var n=0;n<e.length;n++)if(e[n].avatarUrl==r.default.avatarUrl){this.selfRank.visible=!0,a=n,this.selfScore.text=e[n].score+"关",this.SetRankStyle(this.selfRankLbl,this.selfRankIcon,n+1),e[n].viewId;break}this.selfRankLbl.visible=!0,-1==a&&(this.selfScore.text="0",this.SetRankStyle(this.selfRankLbl,this.selfRankIcon,-1,!0))},t.prototype.onRender=function(e,t){var a=this.rankList.array[t],n=e.getChildByName("bg");if(n.getChildByName("img_hand").skin="rank/toux@2x.png",a.avatarUrl&&a.avatarUrl.length>4){var r=a.avatarUrl.replace("/132","/46");n.getChildByName("img_hand").skin=r}n.getChildByName("lbl_nickName").text=a.nickname,n.getChildByName("lbl_pass").text=a.score+"关",a.viewId;var i=n.getChildByName("lbl_rankIndex"),o=n.getChildByName("img_rank");this.SetRankStyle(i,o,t+1)},t.prototype.SetRankStyle=function(e,t,a,n){1==a?(e.text="",t.skin="rank/1@2x.png"):2==a?(e.text="",t.skin="rank/2@2x.png"):3==a?(e.text="",t.skin="rank/3@2x.png"):(t.skin=null,e.text=a.toString())},t}(n.ui.FriendRankUI);a.FriendRankView=i},{"../ui/layaMaxUI":5,"./CommonData":3}],5:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.uiView)},t.uiView={type:"View",props:{width:561,top:0,right:0,left:0,height:791,bottom:0},compId:2,child:[{type:"Image",props:{width:561,var:"anchorS",height:791,centerY:0,centerX:0},compId:3,child:[{type:"List",props:{y:0,x:0,width:560,var:"rankList",spaceY:18,height:688},compId:4,child:[{type:"Box",props:{y:0,x:0,renderType:"render"},compId:12,child:[{type:"Image",props:{width:560,skin:"rank/kuan-phb-1@2x.png",sizeGrid:"12,13,12,12",name:"bg",height:82},compId:5,child:[{type:"Image",props:{y:4.5,x:9,width:61,skin:"rank/1@2x.png",name:"img_rank",height:73},compId:6},{type:"Image",props:{y:7,x:80,width:68,name:"img_hand",height:68},compId:7},{type:"Image",props:{y:16,x:382,width:46,skin:"rank/wa_mini@2x@2x.png",name:"img_ski",height:48},compId:8},{type:"Label",props:{y:34,x:164,width:110,overflow:"hidden",name:"lbl_nickName",height:24,fontSize:24,color:"#004c4f"},compId:9},{type:"Label",props:{y:41,x:42,width:76,valign:"middle",text:"1",strokeColor:"#2c11f1",stroke:2,overflow:"visible",name:"lbl_rankIndex",height:40,fontSize:32,color:"#ffffff",anchorY:.5,anchorX:.5,align:"center"},compId:10},{type:"Label",props:{y:41,x:429,width:109,valign:"middle",text:"1",overflow:"visible",name:"lbl_pass",height:40,fontSize:36,color:"#004c4f",anchorY:.5,anchorX:0,align:"right"},compId:11}]}]}]},{type:"Image",props:{y:700,x:0,width:560,visible:!1,var:"selfRank",skin:"rank/kuan-phb-2@2x.png",sizeGrid:"12,13,12,12",height:82},compId:13,child:[{type:"Image",props:{y:4.5,x:9,width:61,var:"selfRankIcon",skin:"rank/1@2x.png",height:73},compId:14},{type:"Image",props:{y:7,x:80,width:68,var:"selfHead",name:"img_hand",height:68},compId:15},{type:"Image",props:{y:16,x:383,width:46,var:"selfSkin",skin:"rank/wa_mini@2x@2x.png",height:48},compId:16},{type:"Label",props:{y:34,x:164,width:110,var:"selfName",overflow:"hidden",name:"lbl_nickName",height:24,fontSize:24,color:"#004c4f"},compId:17},{type:"Label",props:{y:44,x:40,width:80,var:"selfRankLbl",valign:"middle",text:"1",strokeColor:"#2c11f1",stroke:2,overflow:"visible",name:"lbl_rankIndex",height:40,fontSize:22,color:"#ffffff",anchorY:.5,anchorX:.5,align:"center"},compId:18},{type:"Label",props:{y:41,x:429,width:109,var:"selfScore",valign:"middle",text:"1",overflow:"visible",name:"lbl_pass",height:40,fontSize:36,color:"#004c4f",anchorY:.5,anchorX:0,align:"right"},compId:19},{type:"Label",props:{y:46,x:42,width:76,visible:!1,var:"noRank",valign:"middle",text:"100+",strokeColor:"#2c11f1",stroke:2,overflow:"visible",name:"noRank",height:40,fontSize:30,color:"#ffffff",bold:!1,anchorY:.5,anchorX:.5,align:"center"},compId:20}]}]}],loadList:["rank/kuan-phb-1@2x.png","rank/1@2x.png","rank/wa_mini@2x@2x.png","rank/kuan-phb-2@2x.png"],loadList3D:[]},t}(Laya.View);e.FriendRankUI=t}(a.ui||(a.ui={}))},{}]},{},[2]);